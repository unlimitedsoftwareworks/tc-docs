# Getting Started

<div role="alert" className="alert striped1">
  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" className="stroke-info shrink-0 w-6 h-6"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
  <span>The current setup unfortunately requires building everything from source. A better setup will be available as soon good progress is made.</span>
</div>

## Installation

### 1. Install Type-V

#### Prerequisite:

```bash
git clone https://github.com/unlimitedsoftwareworks/type-v
```

#### MacOS:
```bash

cd type-v
mkdir build && cd build
cmake ..
make
```

#### Ubuntu:
On ubuntu you need to add the following compiler directive to the `CMakeLists.txt` file in the root `type-v` directory:
```
...
set(CMAKE_C_STANDARD 11)

# ADD THESE:
add_definitions(-D_ISOC11_SOURCE)
add_definitions(-D_POSIX_C_SOURCE=200809L)

# regular content
add_subdirectory(stdio)
add_subdirectory(string)
...
```

The reason for this, is the VM using `C11` features such as `aligned_alloc` and `strdup`.
This will be replace with `mi_malloc` soon enough, but for now, they cause sanitizers errors so i had it off.

`clang` is recommended over `gcc` as the performance gains tested on Linux are significant.

```bash
cd type-v
mkdir build && cd build
cmake -DCMAKE_C_COMPILER=clang -DCMAKE_CXX_COMPILER=clang++  ..
make
```

#### Windows:
Untested.

#### Postrequisite:
Export the path to the `type-v` folder as `TYPE_V_PATH` in your environment.

```sh
export TYPE_V_PATH=/path/to/type-v/build
```

### 2: Install Type-C

```sh
npm install -g @unlimitedsoftwareworks/type-c
```
You can now use the `typec` command in your terminal. Type `typec --help` for more information.

```bash
Type-c compiler, version ${compilerVersion}.
Usage: type-c <command> [options]
        --run-tests             Run all unit test
        --compile <dir>         Compile a directory
        --no-generate-binaries  Do not generate binaries
        --output <dir>          Output folder
        --run                   Run the generated output
        --generate-ir           Generate IR and DOT files
        --no-warnings           Do not show warnings
        init <folder>           Initialize a new project at the given folder
        stdlib install          Install the standard library from git
        stdlib update           Updates the standard library from git
        stdlib where            Prints the path to the standard library
```

When you run `typec init <folder>` it will automatically check for updates for the standard library and create a new project in the
folder with a `module.json` file and a `main.tc` file.

Remember you need to have both `TYPE_V_PATH` exported in your environment.

```sh
export TYPE_V_PATH=/path/to/type-v/build
typec -c ./tests/test11 -o ./output --generate-ir --run
```

## Creating a Project

#### Use CLI:
If you have installed the CLI, you can create a new project with the following command:
```sh
typec init [path]
```
This will create the folder if needed, and create a `module.json` and `main.tc` files in the folder.

#### Manual:
To create a new project, we will need to create a new folder, and create a `module.json` file. This file contains the project compiler settings, dependencies, search path, etc.
```json
{
    "name": "Type-C Sample",
    "version": "1.0.0",
    "author": "Replace with your name",
    "dependencies": [],
    "description": "A type-c test case",
    "compiler": {
        "target": "runnable",
        "entry": "main.tc"
    }
}
```

As for now, only the `compiler.entry` field is used. This field specifies the entry point of the project.


## Running the project:
First compiling the project with type-c compiler: `node outs/index.js -c [path-to-module.json folder] -o [output-directory]`
Then run the output with the type-v virtual machine: `./type-v [output-directory]/bin.tvb [output-directory]/src_map.map.txt`

The `src_map.map.txt` file is generated by the compiler and contains the source map to be able to trace crashes.
